<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../logo.png">
    <link rel="stylesheet" href="../style/commons.css">  
    <link rel="stylesheet" href="../style/main.css">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <title>Movie Listing</title>
</head>
<body>
  <div class="container-fluid" style="padding-top: 30px;">
    
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Add Movie</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- MOVIE NAME  -->
            <div class="form-group">
              <label for="movie_name">Movie Name</label>
              <input type="text" class="form-control" id="movie_name" placeholder="Enter Movie Name">
            </div>

            <!-- QUALITY -->
            <div class="form-group">
              <label for="quality">Movie Name</label>
              <select class="form-control" id="quality">
                <option value="">Select Quality</option>
                <option value="hd720p">HD 720</option>
                <option value="hd1080">HD 1080</option>
                <option value="hd4k">HD 4K</option>
              </select>
            </div>        

            <!-- MAGNET LINK -->
            <div class="form-group">
              <label for="magnet_link">Torrent Link</label>
              <input type="text" class="form-control" id="magnet_link" placeholder="Enter torrent URL or Magnet Link">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="addMovie" >Save</button>
          </div>
        </div>
      </div>
    </div>

    <h1>GetNostalgic - Tamilrockerss Movie Indexing</h1>
    
    <!-- Button trigger modal -->
    <form class="form-inline" style="padding:5px;">
      <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#exampleModal">
        Add Movie
      </button>
      <i class="fas fa-search" aria-hidden="true"></i>
      <input class="form-control form-control-sm ml-3 w-50" type="text" placeholder="Search Movie"
        aria-label="Search">
    </form>
    
    <!-- Table -->
    <table class="table">
      <thead class="thead-dark">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Movie Name</th>
          <th scope="col">Quality</th>
          <th scope="col">Magnet Link</th>
        </tr>
      </thead>
      <tbody id="tbody" >
        <tr>
          <th scope="row">1</th>
          <td>Mark</td>
          <td>Otto</td>
          <td>@mdo</td>
        </tr>
        <tr>
          <th scope="row">2</th>
          <td>Jacob</td>
          <td>Thornton</td>
          <td>@fat</td>
        </tr>
        <tr>
          <th scope="row">3</th>
          <td>Larry</td>
          <td>the Bird</td>
          <td>@twitter</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal - DisplayNotification -->
  <div class="notification-container" id="notification-container">
    <i class="fa fa-times" style="float: right;" id="notification-container-close"></i>
    <div class="notification-content" id="notification-content"></div>
  </div>

  <script src="../js/commons.js"></script>
  <script>
    // listeners
    _("addMovie").addEventListener("click", ()=>{
      addMovie();
    })

    async function addMovie(){

      let movie_name = _("movie_name").value;
      let quality = _("quality").value;
      let magnet_link = _("magnet_link").value;

      // validation goes here

      let data = { movie_name, quality, magnet_link }
      
      let res = await post("/api/movie/", data)
      if(!res){
          return;
      }

      clearFields();
    }

    async function getMovie(){
      let res = await get("/api/movie")
      if(!res){
        return;
      }

      fillTable(res.result);
    }

    getMovie();

    function fillTable(movies){
      _("tbody").innerHTML = "";
      movies.forEach((movie, i) =>{
        let tr = create("tr");
        append(tr, create("th", "", "", "", i+1));
        append(tr, create("td", "", "", "", movie.movie_name));
        append(tr, create("td", "", "", "", movie.quality));
        let a = create("a", "", "", "", "Download");
        a.href = movie.magnet_link;
        let td = create("td");
        append(td, a);
        append(tr, td);
        append(_("tbody"), tr);
      })
    }

    function clearFields(){      
      _("movie_name").value = "";
      _("quality").value = "";
      _("magnet_link").value = "";
    }
  </script>
</body>
</html>